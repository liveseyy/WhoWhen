{% extends 'base.html' %}

{% block title %}
    {{ event.title }}
{% endblock %}

{% block content %}
    <h1>{{ event.title }}</h1>

    {% if event.description %}
        <p>{{ event.description }}</p>
    {% endif %}

    <p>{{ event.date_start }} - {{ event.date_end }}</p>

    {% if event.members.all %}
        <div> Идут: 
        {% for member in event.members.all %}
            <p>{{ member.name }}:
                {% for date in member.dates.all %}
                    {{ date.date }},
                {% endfor %} 
            </p>
        {% endfor %}
        </div>
    {% else %}
        <p>Пока никто не отметился</p>
    {% endif %}

    <form method="POST">
        {{ member_form.as_p }}

        <div>
            {% for year, months_with_days in dates_between.items %}
                <h4>{{ year }}</h4>
                    {% for month, days in months_with_days.items %}
                        <h5>{{ month }}</h5>
                            {% for day in days %}
                                {% if forloop.last %}
                                    <span>
                                        <input type="checkbox" name="dates" id="{{ year }}-{{ month }}-{{ day }}"
                                        value="{{ year }}.{{ month }}.{{ day }}">
                                        <label for="{{ year }}-{{ month }}-{{ day }}">{{ day }}</label>
                                    </span>
                                {% else %}
                                    <span>
                                        <input type="checkbox" name="dates" id="{{ year }}-{{ month }}-{{ day }}"
                                        value="{{ year }}.{{ month }}.{{ day }}">
                                        <label for="{{ year }}-{{ month }}-{{ day }}">{{ day }}</label>
                                    </span>
                                {% endif%}
                            {% endfor %}
                    {% endfor %}
            {% endfor %}
        </div>

        {% csrf_token %}
        <button type="submit">Отправить</button>
    </form>

{% endblock %}

{% block domready %}
    <script>
        function checkActiveCheckBoxes() {
            button.disabled = true;
            checkboxes.forEach(checkbox => {
                if (checkbox.checked)
                    button.disabled = false;
            });
        }

        let checkboxes = document.querySelectorAll('input[type=checkbox]');
        let button = document.querySelector('button');
        
        checkActiveCheckBoxes();

        checkboxes.forEach(checkbox => checkbox.addEventListener('change', checkActiveCheckBoxes));
    </script>
{% endblock %}

